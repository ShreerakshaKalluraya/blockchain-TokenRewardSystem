<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login/Register</title>
    <style>
        body { font-family: Arial; display: flex; flex-direction: column; align-items: center; margin-top: 50px; }
        input { margin: 5px; padding: 8px; width: 200px; }
        button { padding: 8px 16px; margin: 10px; }
    </style>
</head>
<body>
    <h2>Register</h2>
    <input id="regUser" placeholder="Username" />
    <input id="regPass" type="password" placeholder="Password" />
    <div>
        <label for="user-email">Email:</label>
        <input type="email" id="user-email" required>
    </div>
   
    <div>
        <label for="user-wallet">MetaMask Wallet Address:</label>
        <input type="text" id="user-wallet" readonly>
        <button id="connect-wallet">Connect MetaMask</button>
    </div>
    <div>
        <label for="user-type">Are you a customer?</label>
        <select id="user-type">
            <option value="Customer">Yes</option>
            <option value="Business">No</option>
        </select>
    </div>
    <button onclick="register()">Register</button>

    <h2>Login</h2>
    <input id="logUser" placeholder="Username" />
    <input id="logPass" type="password" placeholder="Password" />
    <button onclick="login()">Login</button>

    <p id="msg"></p>

    <script>
        async function register() {
            const username = document.getElementById("regUser").value;
            const password = document.getElementById("regPass").value;
            const email = document.getElementById("user-email").value;
            const wallet = document.getElementById("user-wallet").value;
            const userType = document.getElementById("user-type").value;

            const res = await fetch("http://127.0.0.1:3000/register", {
                method: "POST",
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    username: username,
                    password: password,
                    email: email,
                    wallet: wallet,
                    userType: userType
                })
            });
    
            const data = await res.json();
            document.getElementById("msg").textContent = data.message || data.error;
        }
    
        async function login() {
        const username = document.getElementById("logUser").value;
        const password = document.getElementById("logPass").value;

        const res = await fetch("http://127.0.0.1:3000/login", {
            method: "POST",
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });

        const data = await res.json();

        if (res.ok) {
            // Redirect based on user type
            if (data.user_type === 'customer') {
                    window.location.href = 'customer-dashboard.html';
                    } else if (data.user_type === 'business') {
                        window.location.href = 'business-dashboard.html';
                    }

        } else {
            document.getElementById("msg").textContent = data.error;
        }
    }
    
        // Connect MetaMask
        document.getElementById('connect-wallet').addEventListener('click', async function() {
            const walletInput = document.getElementById('user-wallet');
            const msg = document.getElementById('msg');
    
            if (typeof window.ethereum === 'undefined') {
                msg.textContent = 'MetaMask is not installed';
                return;
            }
    
            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                walletInput.value = accounts[0];
                msg.textContent = 'Wallet connected!';
            } catch (error) {
                msg.textContent = 'Failed to connect wallet: ' + error.message;
            }
        });
    </script>
    
</body>
</html>
